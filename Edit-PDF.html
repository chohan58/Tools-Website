<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Editor Plugin — Fixed & Fully Functional</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    /* ---------- Base / Existing Look & Feel (unchanged) ---------- */
    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color:#333; min-height:100vh; padding:20px; display:flex; flex-direction:column; align-items:center; }
    .container { width:100%; max-width:1200px; margin:0 auto; }
    .loading-overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); color:#fff; display:none; align-items:center; justify-content:center; z-index:9999; font-size:18px; }
    .toast { position:fixed; left:50%; transform:translateX(-50%); bottom:24px; background:#222; color:#fff; padding:10px 16px; border-radius:8px; opacity:0; pointer-events:none; transition:opacity .3s; z-index:9999; }
    .toast.show { opacity:1; }

    .home-page { text-align:center; color:#fff; margin-bottom:18px; }
    .home-page h1 { font-size:2.4rem; margin-bottom:10px; text-shadow: 2px 2px 4px rgba(0,0,0,.3); }
    .edit-pdf-btn { margin-top:8px; background:#3498db; color:#fff; border:none; padding:12px 18px; border-radius:10px; cursor:pointer; }

    .upload-page { background:#fff; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.15); padding:24px; }
    .upload-area { border:2px dashed #9bbad6; border-radius:12px; padding:28px; text-align:center; cursor:pointer; background:#f8fbff; }
    .file-input { display:none; }
    .back-btn, .share-btn { margin-top:12px; background:#95a5a6; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }

    .editor-container { background:#fff; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.15); overflow:hidden; margin-top:20px; display:none; }

    .toolbar { background:#2c3e50; color:#fff; padding:12px; display:flex; flex-wrap:wrap; gap:12px; align-items:center; position:relative; }
    .toolbar-group { display:flex; gap:10px; align-items:center; padding-right:15px; border-right:1px solid #3c5065; }
    .toolbar-group:last-child { border-right:none; }
    .toolbar button { background:#3498db; color:#fff; border:none; padding:9px 12px; border-radius:6px; cursor:pointer; transition:all .25s; display:flex; align-items:center; gap:8px; }
    .toolbar button:hover { background:#2980b9; transform: translateY(-1px); }
    .toolbar select, .toolbar input { padding:8px; border-radius:6px; border:1px solid #ddd; background:#fff; }
    .tool-active { outline:2px solid #7ec8ff; }

    .pdf-viewer-container { position:relative; height:70vh; overflow:auto; background:#f0f3f5; display:flex; justify-content:center; padding:30px; }
    .pdf-page { background:#fff; box-shadow:0 5px 15px rgba(0,0,0,.1); width:816px; position:relative; margin:0 auto; overflow:hidden; }
    .pdf-content { position:relative; }
    .page-mock { position:absolute; inset:40px; display:flex; align-items:center; justify-content:center; flex-direction:column; color:#7f8c8d; }

    #pdf-render-canvas { display:block; margin:40px auto; background:#fff; }
    .annotation-canvas, .drawing-canvas { position:absolute; pointer-events:none; }
    .drawing-canvas { pointer-events:auto; }

    .status-bar { background:#ecf0f1; padding:10px 14px; display:flex; align-items:center; justify-content:space-between; border-top:1px solid #e2e8f0; }

    .article-container { margin-top:16px; background:#fff; padding:18px; border-radius:10px; box-shadow:0 6px 14px rgba(0,0,0,.08); }
    .article-container h3{ color:#2c3e50; margin-bottom:10px; text-align:center; font-size:22px; border-bottom:2px solid #3498db; padding-bottom:8px; }
    .article-container p{ color:#7f8c8d; line-height:1.6; margin-bottom:12px; text-align:justify; }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loading-overlay"><div>Loading PDF Editor…</div></div>
  <div class="toast" id="toast"></div>

  <div class="container">
    <div id="home-page" class="home-page">
      <h1>PDF Editor Plugin</h1>
      <p>Advanced text box tools for your PDF editor</p>
      <button id="edit-pdf-btn" class="edit-pdf-btn"><i class="fas fa-edit"></i> EDIT PDF</button>
    </div>

    <div id="upload-page" class="upload-page">
      <h2>Upload Your PDF</h2>
      <p>Select a PDF file to start editing</p>
      <div class="upload-area" id="upload-area">
        <i class="fas fa-file-upload"></i>
        <h3>Drag & Drop your PDF here</h3>
        <p>or click to browse files</p>
        <input type="file" id="file-input-upload" class="file-input" accept="application/pdf" />
      </div>
      <button id="share-btn" class="share-btn"><i class="fas fa-share-alt"></i> Sharing is Caring</button>
      <button class="back-btn" id="back-btn"><i class="fas fa-arrow-left"></i> Back to Home</button>

      <div class="article-container">
        <h3>The Ultimate Guide to PDF Editing</h3>
        <p>Use the tools above to upload and edit a PDF without changing the look & feel of your site.</p>
      </div>
    </div>

    <div class="editor-container" id="editor-container">
      <div class="toolbar">
        <div class="toolbar-group">
          <button id="save-pdf"><i class="fas fa-save"></i> Save</button>
          <button id="print-pdf"><i class="fas fa-print"></i> Print</button>
        </div>
        <div class="toolbar-group">
          <button id="text-tool"><i class="fas fa-font"></i> Text</button>
          <button id="textbox-tool" class="tool-active"><i class="fas fa-square"></i> Text Box</button>
          <button id="draw-tool"><i class="fas fa-pen"></i> Draw</button>
          <button id="highlight-tool"><i class="fas fa-highlighter"></i> Highlight</button>
          <button id="shapes-tool"><i class="fas fa-shapes"></i> Shapes</button>
        </div>
        <div class="toolbar-group">
          <button id="undo"><i class="fas fa-undo"></i> Undo</button>
          <button id="redo"><i class="fas fa-redo"></i> Redo</button>
        </div>
        <div class="toolbar-group">
          <button id="zoom-out"><i class="fas fa-search-minus"></i></button>
          <button id="zoom-reset">100%</button>
          <button id="zoom-in"><i class="fas fa-search-plus"></i></button>
        </div>
      </div>

      <div class="pdf-viewer-container">
        <div class="pdf-page">
          <div class="pdf-content">
            <canvas id="pdf-render-canvas"></canvas>
            <canvas id="annotation-canvas" class="annotation-canvas"></canvas>
            <canvas id="drawing-canvas" class="drawing-canvas"></canvas>
            <div class="page-mock" id="page-mock">
              <i class="fas fa-file-pdf"></i>
              <h2>PDF Document Preview</h2>
              <p>Open a PDF file to start editing</p>
            </div>
          </div>
        </div>
      </div>

      <div class="status-bar">
        <div class="page-info">Page: <span id="page-num">1</span> / <span id="page-count">1</span></div>
        <div class="page-controls">
          <button id="prev-page"><i class="fas fa-chevron-left"></i> Previous</button>
          <button id="next-page">Next <i class="fas fa-chevron-right"></i></button>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.min.js"></script>
  <script>
    // ✅ Ensure PDF.js worker is loaded
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.worker.min.js';

    const state = { pdfDoc:null, pageNum:1, pageCount:1, zoomLevel:100, pdfFileUrl:null, drawing:false, lastX:0, lastY:0 };

    const elements = {
      homePage:document.getElementById('home-page'),
      uploadPage:document.getElementById('upload-page'),
      editorContainer:document.getElementById('editor-container'),
      editPdfBtn:document.getElementById('edit-pdf-btn'),
      uploadArea:document.getElementById('upload-area'),
      fileInputUpload:document.getElementById('file-input-upload'),
      backBtn:document.getElementById('back-btn'),
      pdfCanvas:document.getElementById('pdf-render-canvas'),
      pageMock:document.getElementById('page-mock'),
      pageNumElem:document.getElementById('page-num'),
      pageCountElem:document.getElementById('page-count'),
      nextPageBtn:document.getElementById('next-page'),
      prevPageBtn:document.getElementById('prev-page'),
      zoomInBtn:document.getElementById('zoom-in'),
      zoomOutBtn:document.getElementById('zoom-out'),
      zoomResetBtn:document.getElementById('zoom-reset'),
      loadingOverlay:document.getElementById('loading-overlay'),
      toast:document.getElementById('toast'),
      drawingCanvas:document.getElementById('drawing-canvas')
    };

    function showToast(msg){ elements.toast.textContent=msg; elements.toast.classList.add('show'); setTimeout(()=>elements.toast.classList.remove('show'),2000); }
    function showUploadPage(){ elements.homePage.style.display='none'; elements.uploadPage.style.display='block'; elements.editorContainer.style.display='none'; }
    function showEditor(){ elements.homePage.style.display='none'; elements.uploadPage.style.display='none'; elements.editorContainer.style.display='block'; }

    async function loadPdfFromFile(file){
      if(!file) return;
      const isPdf = file.type==='application/pdf'||file.name.toLowerCase().endsWith('.pdf');
      if(!isPdf){ showToast('Invalid PDF file'); return; }

      elements.loadingOverlay.style.display='flex';
      try {
        if(state.pdfFileUrl) URL.revokeObjectURL(state.pdfFileUrl);
        state.pdfFileUrl = URL.createObjectURL(file);
        const loadingTask = pdfjsLib.getDocument(state.pdfFileUrl);
        state.pdfDoc = await loadingTask.promise;
        state.pageCount=state.pdfDoc.numPages; state.pageNum=1;
        elements.pageCountElem.textContent=state.pageCount;
        elements.pageNumElem.textContent=state.pageNum;
        elements.pageMock.style.display='none';
        await renderPage();
        showEditor();
        showToast('PDF loaded');
      } catch(e){ console.error(e); showToast('Failed to load PDF file'); }
      finally { elements.loadingOverlay.style.display='none'; }
    }

    async function renderPage(){
      const page=await state.pdfDoc.getPage(state.pageNum);
      const viewport=page.getViewport({scale:state.zoomLevel/100});
      const canvas=elements.pdfCanvas, ctx=canvas.getContext('2d');
      canvas.width=viewport.width; canvas.height=viewport.height;
      await page.render({canvasContext:ctx,viewport}).promise;
    }

    elements.editPdfBtn.onclick=showUploadPage;
    elements.backBtn.onclick=()=>{ elements.homePage.style.display='block'; elements.uploadPage.style.display='none'; };
    elements.fileInputUpload.onchange=e=>loadPdfFromFile(e.target.files[0]);
    elements.uploadArea.onclick=()=>elements.fileInputUpload.click();
    elements.nextPageBtn.onclick=async()=>{ if(state.pageNum<state.pageCount){ state.pageNum++; elements.pageNumElem.textContent=state.pageNum; await renderPage(); } };
    elements.prevPageBtn.onclick=async()=>{ if(state.pageNum>1){ state.pageNum--; elements.pageNumElem.textContent=state.pageNum; await renderPage(); } };
    elements.zoomInBtn.onclick=()=>{ state.zoomLevel+=10; elements.zoomResetBtn.textContent=state.zoomLevel+'%'; renderPage(); };
    elements.zoomOutBtn.onclick=()=>{ if(state.zoomLevel>20){ state.zoomLevel-=10; elements.zoomResetBtn.textContent=state.zoomLevel+'%'; renderPage(); } };
    elements.zoomResetBtn.onclick=()=>{ state.zoomLevel=100; elements.zoomResetBtn.textContent='100%'; renderPage(); };

    showUploadPage();
  </script>
</body>
</html>

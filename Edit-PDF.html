<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Edit PDF Tool</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    /* === GLOBAL STYLES (Menus, Tabs, Layout) === */
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
    body{background:#f5f7fa;color:#333;min-height:100vh;}
    header, nav, footer{background:#2c3e50;color:#fff;padding:12px;text-align:center;}
    nav a{color:#fff;margin:0 12px;text-decoration:none;font-weight:500;}
    nav a:hover{text-decoration:underline;}

    .container{max-width:1200px;margin:auto;padding:20px;}

    /* === PDF Editor Tool Styles === */
    .home-page{text-align:center;margin-bottom:18px;}
    .edit-pdf-btn{margin-top:8px;background:#3498db;color:#fff;border:none;padding:12px 18px;border-radius:10px;cursor:pointer;}

    .upload-page{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.15);padding:24px;display:none;}
    .upload-area{border:2px dashed #aaa;border-radius:12px;padding:28px;text-align:center;cursor:pointer;}
    .upload-area:hover{border-color:#3498db;}
    .file-input{display:none;}

    .editor-container{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.15);margin-top:20px;display:none;}
    .toolbar{background:#2c3e50;color:#fff;padding:12px;display:flex;gap:12px;flex-wrap:wrap;}
    .toolbar button{background:#3498db;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;}
    .toolbar button:hover{background:#2980b9;}
    .tool-active{outline:2px solid #7ec8ff;}

    .pdf-viewer-container{position:relative;height:70vh;overflow:auto;background:#f0f3f5;display:flex;justify-content:center;padding:30px;}
    #pdf-canvas{background:#fff;box-shadow:0 5px 15px rgba(0,0,0,.1);margin:auto;}
    #drawing-canvas{position:absolute;top:30px;left:0;pointer-events:auto;}

    .textbox-container{position:absolute;border:1px solid #3498db;border-radius:6px;background:#fff;padding:4px;z-index:10;}
    .textbox-content{width:100%;height:100%;border:none;outline:none;resize:none;background:transparent;}

    .status-bar{background:#ecf0f1;padding:10px 14px;display:flex;justify-content:space-between;border-top:1px solid #ccc;}
  </style>
</head>
<body>
  <header>
    <h1>My Website</h1>
    <nav>
      <a href="#">Home</a>
      <a href="#">About</a>
      <a href="Edit-PDF.html">Edit PDF</a>
      <a href="#">Contact</a>
    </nav>
  </header>

  <div class="container">
    <!-- Home -->
    <div id="home-page" class="home-page">
      <h2>PDF Editor Tool</h2>
      <p>Upload your PDF and edit with text boxes, drawings, highlights, and shapes.</p>
      <button id="edit-pdf-btn" class="edit-pdf-btn"><i class="fas fa-edit"></i> EDIT PDF</button>
    </div>

    <!-- Upload -->
    <div id="upload-page" class="upload-page">
      <h2>Upload Your PDF</h2>
      <div class="upload-area" id="upload-area">
        <i class="fas fa-file-upload"></i>
        <p>Click or Drag & Drop a PDF file</p>
        <input type="file" id="file-input" class="file-input" accept="application/pdf" />
      </div>
      <button id="back-btn" class="edit-pdf-btn" style="background:#95a5a6;"><i class="fas fa-arrow-left"></i> Back</button>
    </div>

    <!-- Editor -->
    <div class="editor-container" id="editor-container">
      <div class="toolbar">
        <button id="save-pdf"><i class="fas fa-save"></i> Save</button>
        <button id="print-pdf"><i class="fas fa-print"></i> Print</button>
        <button id="textbox-tool" class="tool-active"><i class="fas fa-square"></i> Text Box</button>
        <button id="draw-tool"><i class="fas fa-pen"></i> Draw</button>
        <button id="highlight-tool"><i class="fas fa-highlighter"></i> Highlight</button>
        <button id="shape-tool"><i class="fas fa-shapes"></i> Shape</button>
        <button id="zoom-out"><i class="fas fa-search-minus"></i></button>
        <button id="zoom-reset">100%</button>
        <button id="zoom-in"><i class="fas fa-search-plus"></i></button>
      </div>

      <div class="pdf-viewer-container" id="pdf-container">
        <canvas id="pdf-canvas"></canvas>
        <canvas id="drawing-canvas"></canvas>
      </div>

      <div class="status-bar">
        <div>Page: <span id="page-num">1</span>/<span id="page-count">1</span></div>
        <div>
          <button id="prev-page"><i class="fas fa-chevron-left"></i> Prev</button>
          <button id="next-page">Next <i class="fas fa-chevron-right"></i></button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 My Website. All rights reserved.</p>
  </footer>

  <!-- PDF.js + PDF-LIB -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.worker.min.js"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.worker.min.js';

    const state={pdfDoc:null,pageNum:1,pageCount:1,zoom:1.2,tool:'textbox',drawing:false,lastX:0,lastY:0};

    const fileInput=document.getElementById('file-input');
    const uploadArea=document.getElementById('upload-area');
    const homePage=document.getElementById('home-page');
    const uploadPage=document.getElementById('upload-page');
    const editor=document.getElementById('editor-container');
    const canvas=document.getElementById('pdf-canvas');
    const ctx=canvas.getContext('2d');
    const drawCanvas=document.getElementById('drawing-canvas');
    const drawCtx=drawCanvas.getContext('2d');

    // Navigation
    document.getElementById('edit-pdf-btn').onclick=()=>{homePage.style.display='none';uploadPage.style.display='block';};
    document.getElementById('back-btn').onclick=()=>{homePage.style.display='block';uploadPage.style.display='none';editor.style.display='none';};

    // File picker
    uploadArea.onclick=()=>fileInput.click();
    fileInput.onchange=e=>loadPdf(e.target.files[0]);

    // Drag & drop
    ['dragenter','dragover'].forEach(ev=>uploadArea.addEventListener(ev,e=>{e.preventDefault();uploadArea.style.borderColor='#3498db';}));
    ['dragleave','drop'].forEach(ev=>uploadArea.addEventListener(ev,e=>{e.preventDefault();uploadArea.style.borderColor='#aaa';}));
    uploadArea.addEventListener('drop',e=>{if(e.dataTransfer.files[0]) loadPdf(e.dataTransfer.files[0]);});

    async function loadPdf(file){
      if(!file) return;
      if(file.type!=='application/pdf'&&!file.name.endsWith('.pdf')){alert('Please upload a PDF');return;}
      const url=URL.createObjectURL(file);
      try{
        state.pdfDoc=await pdfjsLib.getDocument({url}).promise;
        state.pageCount=state.pdfDoc.numPages; state.pageNum=1;
        document.getElementById('page-count').textContent=state.pageCount;
        await renderPage();
        uploadPage.style.display='none'; editor.style.display='block';
      }catch(err){console.error(err);alert('Failed to load PDF');}
    }

    async function renderPage(){
      const page=await state.pdfDoc.getPage(state.pageNum);
      const viewport=page.getViewport({scale:state.zoom});
      canvas.width=viewport.width; canvas.height=viewport.height;
      drawCanvas.width=viewport.width; drawCanvas.height=viewport.height;
      await page.render({canvasContext:ctx,viewport}).promise;
      document.getElementById('page-num').textContent=state.pageNum;
    }

    // Tools
    const tools=['textbox','draw','highlight','shape'];
    tools.forEach(t=>document.getElementById(t+'-tool').onclick=()=>{state.tool=t;setActive(t+'-tool');});
    function setActive(id){document.querySelectorAll('.toolbar button').forEach(b=>b.classList.remove('tool-active'));document.getElementById(id).classList.add('tool-active');}

    // Textbox creation
    canvas.parentElement.addEventListener('dblclick',e=>{
      if(state.tool!=='textbox') return;
      const rect=canvas.getBoundingClientRect();
      const box=document.createElement('div');
      box.className='textbox-container';
      box.style.left=(e.clientX-rect.left)+'px';
      box.style.top=(e.clientY-rect.top)+'px';
      box.style.width='150px'; box.style.height='50px';
      const ta=document.createElement('textarea');
      ta.className='textbox-content';
      ta.value='Type...';
      box.appendChild(ta);
      document.getElementById('pdf-container').appendChild(box);
      let drag=false,offX=0,offY=0;
      box.addEventListener('mousedown',ev=>{drag=true;offX=ev.offsetX;offY=ev.offsetY;});
      document.addEventListener('mousemove',ev=>{if(drag){box.style.left=(ev.clientX-rect.left-offX)+'px';box.style.top=(ev.clientY-rect.top-offY)+'px';}});
      document.addEventListener('mouseup',()=>drag=false);
    });

    // Drawing / Highlight / Shape
    drawCanvas.addEventListener('mousedown',e=>{
      if(!['draw','highlight','shape'].includes(state.tool)) return;
      state.drawing=true;
      const rect=drawCanvas.getBoundingClientRect();
      state.lastX=e.clientX-rect.left; state.lastY=e.clientY-rect.top;
    });
    drawCanvas.addEventListener('mousemove',e=>{
      if(!state.drawing) return;
      const rect=drawCanvas.getBoundingClientRect();
      const x=e.clientX-rect.left, y=e.clientY-rect.top;
      drawCtx.beginPath();
      drawCtx.moveTo(state.lastX,state.lastY);
      drawCtx.lineTo(x,y);
      drawCtx.strokeStyle=(state.tool==='highlight')?'yellow':'red';
      drawCtx.globalAlpha=(state.tool==='highlight')?0.4:1;
      drawCtx.lineWidth=(state.tool==='shape')?4:2;
      drawCtx.stroke();
      drawCtx.globalAlpha=1;
      state.lastX=x; state.lastY=y;
    });
    ['mouseup','mouseleave'].forEach(ev=>drawCanvas.addEventListener(ev,()=>state.drawing=false));

    // Zoom + pages
    document.getElementById('zoom-in').onclick=()=>{state.zoom+=0.2;renderPage();document.getElementById('zoom-reset').textContent=Math.round(state.zoom*100)+'%';};
    document.getElementById('zoom-out').onclick=()=>{if(state.zoom>0.4){state.zoom-=0.2;renderPage();document.getElementById('zoom-reset').textContent=Math.round(state.zoom*100)+'%';}};
    document.getElementById('zoom-reset').onclick=()=>{state.zoom=1.2;renderPage();document.getElementById('zoom-reset').textContent='100%';};
    document.getElementById('next-page').onclick=()=>{if(state.pageNum<state.pageCount){state.pageNum++;renderPage();}};
    document.getElementById('prev-page').onclick=()=>{if(state.pageNum>1){state.pageNum--;renderPage();}};

    document.getElementById('print-pdf').onclick=()=>window.print();

    // === SAVE TO PDF ===
    document.getElementById('save-pdf').onclick = async () => {
      if (!state.pdfDoc) { alert("No PDF loaded"); return; }
      try {
        const pdfBytes = await state.pdfDoc.getData();
        const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
        const pages = pdfDoc.getPages();

        // Flatten drawings
        const drawingURL = drawCanvas.toDataURL("image/png");
        if (drawingURL) {
          const pngImage = await pdfDoc.embedPng(drawingURL);
          const page = pages[state.pageNum - 1];
          page.drawImage(pngImage, {
            x: 0,
            y: 0,
            width: canvas.width,
            height: canvas.height,
          });
        }

        // Flatten textboxes
        const textboxes = document.querySelectorAll(".textbox-container");
        textboxes.forEach((box) => {
          const ta = box.querySelector("textarea");
          if (ta && ta.value.trim() !== "") {
            const page = pages[state.pageNum - 1];
            const rect = canvas.getBoundingClientRect();
            const boxX = parseFloat(box.style.left);
            const boxY = parseFloat(box.style.top);
            page.drawText(ta.value, {
              x: boxX,
              y: rect.height - boxY - 20,
              size: 12,
              color: PDFLib.rgb(0, 0, 0),
            });
          }
        });

        const newPdfBytes = await pdfDoc.save();
        const blob = new Blob([newPdfBytes], { type: "application/pdf" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "edited.pdf";
        link.click();
      } catch (err) {
        console.error(err);
        alert("Error saving PDF: " + err.message);
      }
    };
  </script>
</body>
</html>
